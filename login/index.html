<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta name="viewport" http-equiv="Content-Type" content="text/html; charset=utf-8,user-scalable=no" />
		<title>United Way: Log in</title>
		<link href="../css/reset.css" rel="stylesheet" type="text/css" />
		<link href="../css/default.css" rel="stylesheet" type="text/css" />
		<link href="css/login.css" rel="stylesheet" type="text/css" />
		<script src="../js/generator.js" type="text/javascript"></script>

	</head>


	<body>
		<div class="wrapper">

			<script>
				generateHeader("Welcome!", false, false);	
			</script>
			<br>	
			<div id="mainText"><p>Welcome to United Way's Pre-K app! Please log in below.</p></div>
	
			<div id="content">

				<div id='login-fields'>
					<script>
						generateInputText("Email Address", "", "email", "email");
						document.write("<br>");
						generateInputText("Password", "", "password", "password");

					</script>
				</div>
				<br><br>	
				<div id="result"></div>
				
		
				<div id="option-links">
					<script>
						generateButton("I'm a new user", "new-user", "bt-yellow", "registration()");
						generateButton("Log in", "login", "bt-yellow", "verifyLogin()");

					</script>
				</div>
				



			</div>

			<!-- end of login-wrapper -->
			<script type="text/javascript">	// Create HTTP request for server
			// Sends request to match user input with user data table on Lostpoint Database
			function registration() {
				document.location.href="registration.html";

			}
			function verifyLogin() {
				var iEmail = document.getElementById("email").value;
				var iPass = document.getElementById("password").value;
				// Variables used for XML/HTTP Request.
				var httpRequest;
				var loginUrl = "php/login.php";
				var params = "pUser=" + iEmail +"&pPass=" + iPass;
				
				// Create XML/HTTP Request object.
				// Different browsers use different objects!
				if (window.XMLHttpRequest)
					{// code for IE7+, Firefox, Chrome, Opera, Safari
					httpRequest= new XMLHttpRequest();
					}
				else
					{// code for IE6, IE5
					httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
					}
					
				// Handle PHP returns
				httpRequest.onreadystatechange=function() {
					if (httpRequest.readyState == 4 && httpRequest.status == 200) {
						var ret = parseInt(httpRequest.responseText);
						if (ret == 0) { // unSuccessful Login
							document.getElementById("result").innerHTML = "<p id='fail'>Login failed. Please verify that your email and password are correct</p>";
						}
						else { // Successful login	
							// USE HTML5 WEB STORAGE : SUPPORTED BY IE 8+ 
							if(typeof(Storage) !== "undefined"){
								sessionStorage.pid = ret;
								sessionStorage.rss = 'cpl';
								document.location.href = "../home/";
							}
							else {
								// Add old client support (cookies) later, browser share for IE 7- 
								document.getElementById("result").innerHTML = "Sorry, your browser does not support web storage...";
							}
						}
					}
				}
				
				// Send the request to server!
				httpRequest.open("POST",loginUrl,true);
				httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				httpRequest.send(params);
			
			}
			</script>
	</body>
</html>
