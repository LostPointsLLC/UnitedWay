<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<form action = "php/mobileregisterhandler.php" method = "post">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>United Way: Register</title>
		<link href="css/reset.css" rel="stylesheet" type="text/css" />
		<link href="css/registration.css" rel="stylesheet" type="text/css" />
	</head>


	<body>


		<div id="registration-wrapper">
		  
		  
			<div id="titleBar"><img src="images/welcome-title.png"/></div>


			<div id="mainText"><p>Welcome to the United Way of Champaign Pre-k app. You can register here!  </p>
			</div>
	

			<input type="text" class="text-input" id="firstname" placeholder="First Name"/>
			<input type="text" class="text-input" id="lastname" placeholder="Last Name"/>
			<input type="text" class="text-input" id="phone" placeholder="Phone Number (only numbers)"/>
			<input type="text" class="text-input" id="email" placeholder="Email address"/>
			<input type="password" class="text-input" id="password" placeholder="Password"/>


			<input type="button" class="button" name="button" Value="Click" onClick="verfiyRegistration()"/>
			<div id="result"></div>
		

			<!-- end of registration-wrapper -->
			<script src="js/checkLogin.js"></script>
			<script type="text/javascript">	// Create HTTP request for server

			function verfiyRegistration() {
				var first = document.getElementById("firstname").value;
				var last = document.getElementById("lastname").value;
				var phone = document.getElementById("phone").value;
				var email = document.getElementById("email").value;
				var pass = document.getElementById("password").value;
				
				// Check checkLogin.js for documentation
				// DOES NOT VERIFY THE PASSWORD
				if(!checkLogin(first, last, phone, email, pass)) return;
				
				
				// Variables used for XML/HTTP Request.
				var httpRequest;
				var loginUrl = "php/registration.php";
				var params = "pFname=" + first + "&pLname=" + last+ "&pPhone=" + phone+ "&pEmail=" + email +"&pPass=" + pass;

				// Create XML/HTTP Request object.
				// Different browsers use different objects!
				if (window.XMLHttpRequest)
					{// code for IE7+, Firefox, Chrome, Opera, Safari
					httpRequest= new XMLHttpRequest();
					}
				else
					{// code for IE6, IE5
					httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
					}
					
				// Handle PHP returns
				httpRequest.onreadystatechange = function() {
					if (httpRequest.readyState == 4 && httpRequest.status == 200) {
						var ret = parseInt(httpRequest.responseText);
						
						/* if 0, then we have a successful creation
						 * if 1, then the email was already taken
						 */
						if(ret == 1) {
							alert("Apparently you have an account already.");
							return;
						}
						
						else if(ret == 0) {
							// USE HTML5 WEB STORAGE : SUPPORTED BY IE 8+ 
							/* Incorrect code */
							if(typeof(Storage) !== "undefined"){
								sessionStorage.pid = ret;
								alert("Success!");
							}
							
							else {
								// Add old client support (cookies) later, browser share for IE 7- 
								document.getElementById("result").innerHTML = "Sorry, your browser does not support web storage...";
							}
						
						}
						
						else {
							alert("Strange error occured. Check code");
						
						}

					}
				}
				
				// Send the request to server!
				httpRequest.open("POST", loginUrl, true);
				httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				httpRequest.send(params);
			
			}
			
			</script>

			</div>
	</body>
</html>
